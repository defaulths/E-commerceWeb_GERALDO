<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Green Valley Farmers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .cart-empty {
            text-align: center;
            padding: 60px 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .cart-empty-icon {
            font-size: 80px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .cart-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .cart-note {
            background-color: #fff8e1;
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-top: 30px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        .cart-note h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .promo-code {
            background-color: #f0f7e6;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
        }
        
        .promo-code input {
            flex-grow: 1;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
        }
        
        .promo-code .btn {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- Skip to Content Link (Accessibility) -->
    <a href="#main-content" class="skip-to-content">Skip to Content</a>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-seedling logo-icon"></i>
                <span class="logo-text">Green Valley Farmers</span>
            </a>
            
            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="main-nav" aria-label="Main navigation">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="cart.html" class="active">Cart <span class="cart-count">0</span></a></li>
                    <li><a href="#" class="btn btn-accent">Farmer Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb" style="background-color: #f9f9f9; padding: 15px 0;">
        <div class="container">
            <a href="index.html">Home</a> &gt; 
            <a href="products.html">Products</a> &gt; 
            <span>Shopping Cart</span>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <section class="cart-page">
            <div class="container">
                <div class="cart-header">
                    <h1>Shopping Cart</h1>
                    <div style="color: #666;">
                        <span id="item-count">0</span> items
                    </div>
                </div>
                
                <!-- Empty Cart State -->
                <div id="empty-cart" class="cart-empty" style="display: none;">
                    <div class="cart-empty-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h2>Your cart is empty</h2>
                    <p>Looks like you haven't added any products to your cart yet.</p>
                    <div style="margin-top: 30px;">
                        <a href="products.html" class="btn btn-accent btn-large">
                            <i class="fas fa-shopping-bag"></i> Start Shopping
                        </a>
                    </div>
                </div>
                
                <!-- Cart with Items -->
                <div id="cart-with-items" style="display: none;">
                    <div class="cart-container">
                        <!-- Cart Items -->
                        <div class="cart-items" id="cart-items-container">
                            <!-- Cart items will be loaded by JavaScript -->
                        </div>
                        
                        <!-- Promo Code -->
                        <div class="promo-code">
                            <h4 style="margin-bottom: 15px;">Have a promo code?</h4>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="promo-code" placeholder="Enter promo code">
                                <button type="button" id="apply-promo" class="btn">Apply</button>
                            </div>
                            <div id="promo-message" style="margin-top: 10px; font-size: 0.9rem;"></div>
                        </div>
                        
                        <!-- Cart Note -->
                        <div class="cart-note">
                            <h4><i class="fas fa-info-circle"></i> Note for Farmer</h4>
                            <textarea id="cart-note" placeholder="Add any special instructions for your order (e.g., delivery instructions, specific ripeness preferences)" 
                                      style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: var(--border-radius); min-height: 80px; margin-top: 10px;"></textarea>
                        </div>
                        
                        <!-- Cart Summary -->
                        <div class="cart-summary">
                            <div class="cart-summary-row">
                                <span>Subtotal</span>
                                <span id="cart-subtotal">$0.00</span>
                            </div>
                            <div class="cart-summary-row">
                                <span>Shipping</span>
                                <span id="cart-shipping">$5.99</span>
                            </div>
                            <div class="cart-summary-row" id="discount-row" style="display: none;">
                                <span>Discount</span>
                                <span id="cart-discount" style="color: var(--success-color);">-$0.00</span>
                            </div>
                            <div class="cart-summary-row">
                                <span><strong>Total</strong></span>
                                <span><strong id="cart-total">$0.00</strong></span>
                            </div>
                        </div>
                        
                        <!-- Cart Actions -->
                        <div class="cart-actions">
                            <a href="products.html" class="btn btn-outline">
                                <i class="fas fa-arrow-left"></i> Continue Shopping
                            </a>
                            <button id="clear-cart" class="btn" style="background-color: #f8d7da; color: #721c24;">
                                <i class="fas fa-trash"></i> Clear Cart
                            </button>
                            <a href="checkout.html" class="btn btn-accent btn-large" id="proceed-checkout" style="flex-grow: 1;">
                                <i class="fas fa-lock"></i> Proceed to Checkout
                            </a>
                        </div>
                        
                        <!-- Security Note -->
                        <div style="margin-top: 30px; text-align: center; color: #666; font-size: 0.9rem;">
                            <p><i class="fas fa-lock"></i> Secure checkout. Your payment information is encrypted.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Recently Viewed -->
        <section style="padding: 60px 0; background-color: #f5f9f0;">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 30px;">Recently Viewed</h2>
                <div class="products-grid" id="recently-viewed">
                    <!-- Recently viewed products will be loaded by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <div class="footer-logo">
                        <i class="fas fa-seedling"></i> Green Valley Farmers
                    </div>
                    <p>Connecting local farmers with communities through sustainable agriculture and fresh, organic produce since 2010.</p>
                    <div class="social-icons">
                        <a href="#" class="social-icon" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="cart.html">Shopping Cart</a></li>
                        <li><a href="checkout.html">Checkout</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Customer Service</h4>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Returns & Refunds</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Contact Us</h4>
                    <p>123 Farm Road, Green Valley, CA 90210</p>
                    <p>Email: info@greenvalleyfarmers.com</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Green Valley Farmers. All rights reserved. | Designed with HCI principles for accessibility and user experience</p>
            </div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadCartPage();
            
            // Apply promo code
            const applyPromoBtn = document.getElementById('apply-promo');
            if (applyPromoBtn) {
                applyPromoBtn.addEventListener('click', applyPromoCode);
            }
            
            const promoCodeInput = document.getElementById('promo-code');
            if (promoCodeInput) {
                promoCodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyPromoCode();
                    }
                });
            }
            
            // Load recently viewed products
            loadRecentlyViewed();
        });
        
        function loadCartPage() {
            const emptyCartDiv = document.getElementById('empty-cart');
            const cartWithItemsDiv = document.getElementById('cart-with-items');
            const itemCountSpan = document.getElementById('item-count');
            
            if (cart.length === 0) {
                emptyCartDiv.style.display = 'block';
                cartWithItemsDiv.style.display = 'none';
                return;
            }
            
            emptyCartDiv.style.display = 'none';
            cartWithItemsDiv.style.display = 'block';
            
            // Update item count
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            itemCountSpan.textContent = totalItems;
            
            // Load cart items
            loadCartItems();
            
            // Calculate totals
            calculateCartTotals();
            
            // Add event listeners
            document.getElementById('clear-cart').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear your cart? This action cannot be undone.')) {
                    clearCart();
                    loadCartPage();
                    showToast('success', 'Cart cleared successfully.');
                }
            });
            
            // Update proceed to checkout button
            const proceedBtn = document.getElementById('proceed-checkout');
            if (proceedBtn) {
                if (cart.length === 0) {
                    proceedBtn.style.opacity = '0.6';
                    proceedBtn.style.cursor = 'not-allowed';
                    proceedBtn.onclick = function(e) {
                        e.preventDefault();
                        showToast('warning', 'Your cart is empty. Add some products first.');
                    };
                } else {
                    proceedBtn.style.opacity = '1';
                    proceedBtn.style.cursor = 'pointer';
                    proceedBtn.onclick = null;
                }
            }
        }
        
        function loadCartItems() {
            const cartItemsContainer = document.getElementById('cart-items-container');
            if (!cartItemsContainer) return;
            
            let html = '';
            
            cart.forEach((item, index) => {
                const product = getProductById(item.id);
                if (!product) return;
                
                const itemTotal = item.price * item.quantity;
                
                html += `
                    <div class="cart-item" data-index="${index}">
                        <div class="cart-item-image">
                            ${item.image}
                        </div>
                        <div class="cart-item-details">
                            <h3 class="cart-item-name">${item.name}</h3>
                            <div class="cart-item-price">${formatPrice(item.price)} ${item.unit}</div>
                            <div class="cart-item-actions">
                                <button class="quantity-btn decrease-item" aria-label="Decrease quantity">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="item-quantity">${item.quantity}</span>
                                <button class="quantity-btn increase-item" aria-label="Increase quantity">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="btn btn-small remove-item" style="background-color: #f8d7da; color: #721c24;">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                        <div class="cart-item-total">
                            <strong>${formatPrice(itemTotal)}</strong>
                        </div>
                    </div>
                `;
            });
            
            cartItemsContainer.innerHTML = html;
            
            // Add event listeners to cart controls
            document.querySelectorAll('.decrease-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.closest('.cart-item').getAttribute('data-index'));
                    const item = cart[index];
                    if (item.quantity > 1) {
                        updateCartQuantity(item.id, item.quantity - 1);
                        loadCartPage();
                        showToast('success', 'Quantity updated.');
                    }
                });
            });
            
            document.querySelectorAll('.increase-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.closest('.cart-item').getAttribute('data-index'));
                    const item = cart[index];
                    const product = getProductById(item.id);
                    if (item.quantity < product.stock) {
                        updateCartQuantity(item.id, item.quantity + 1);
                        loadCartPage();
                        showToast('success', 'Quantity updated.');
                    } else {
                        showToast('warning', 'Cannot add more items. Stock limit reached.');
                    }
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.closest('.cart-item').getAttribute('data-index'));
                    const item = cart[index];
                    if (confirm(`Remove ${item.name} from cart?`)) {
                        removeFromCart(item.id);
                        loadCartPage();
                        showToast('success', 'Item removed from cart.');
                    }
                });
            });
        }
        
        function calculateCartTotals() {
            const subtotal = getCartTotal();
            const shipping = subtotal >= 50 ? 0 : 5.99;
            
            // Apply promo code discount if any
            let discount = 0;
            const promoCode = localStorage.getItem('activePromoCode');
            if (promoCode === 'FARMER10' && subtotal > 0) {
                discount = subtotal * 0.10; // 10% discount
            }
            
            const total = subttotal + shipping - discount;
            
            // Update display
            document.getElementById('cart-subtotal').textContent = formatPrice(subtotal);
            document.getElementById('cart-shipping').textContent = shipping === 0 ? 'FREE' : formatPrice(shipping);
            document.getElementById('cart-total').textContent = formatPrice(total);
            
            // Show/hide discount row
            const discountRow = document.getElementById('discount-row');
            const cartDiscount = document.getElementById('cart-discount');
            if (discount > 0) {
                discountRow.style.display = 'flex';
                cartDiscount.textContent = '-' + formatPrice(discount);
            } else {
                discountRow.style.display = 'none';
            }
            
            // Update shipping note
            if (subtotal < 50 && subtotal > 0) {
                const shippingNote = document.createElement('div');
                shippingNote.style.fontSize = '0.9rem';
                shippingNote.style.color = '#666';
                shippingNote.style.marginTop = '5px';
                shippingNote.innerHTML = `Add $${formatPrice(50 - subttotal)} more for free shipping!`;
                
                const shippingElement = document.querySelector('.cart-summary-row:nth-child(2)');
                if (shippingElement && !shippingElement.querySelector('.shipping-note')) {
                    shippingElement.appendChild(shippingNote);
                    shippingNote.classList.add('shipping-note');
                }
            }
        }
        
        function applyPromoCode() {
            const promoCodeInput = document.getElementById('promo-code');
            const promoMessage = document.getElementById('promo-message');
            
            if (!promoCodeInput || !promoMessage) return;
            
            const code = promoCodeInput.value.trim().toUpperCase();
            
            if (!code) {
                promoMessage.innerHTML = '<span style="color: var(--error-color);">Please enter a promo code.</span>';
                return;
            }
            
            // Valid promo codes (in a real app, these would come from a server)
            const validCodes = {
                'FARMER10': '10% off your entire order',
                'WELCOME5': '$5 off your first order',
                'LOCAL15': '15% off for local residents'
            };
            
            if (validCodes[code]) {
                localStorage.setItem('activePromoCode', code);
                promoMessage.innerHTML = `<span style="color: var(--success-color);">
                    <i class="fas fa-check-circle"></i> Promo code applied: ${validCodes[code]}
                </span>`;
                showToast('success', 'Promo code applied successfully!');
                
                // Recalculate totals
                calculateCartTotals();
            } else {
    promoMessage.innerHTML = '<span style="color: var(--error-color);"><i class="fas fa-times-circle"></i> Invalid promo code. Please try again.</span>';
    showToast('error', 'Invalid promo code.');
}
        }
        
        function loadRecentlyViewed() {
            const recentlyViewedContainer = document.getElementById('recently-viewed');
            if (!recentlyViewedContainer) return;
            
            // Get recently viewed from localStorage (in a real app, this would be user-specific)
            const recentlyViewedIds = JSON.parse(localStorage.getItem('recentlyViewed')) || [1, 2, 3, 4];
            
            // Get products that are in the recently viewed list
            const recentlyViewedProducts = products.filter(product => 
                recentlyViewedIds.includes(product.id)
            ).slice(0, 4);
            
            if (recentlyViewedProducts.length === 0) {
                recentlyViewedContainer.innerHTML = '<p style="text-align: center; grid-column: 1 / -1;">No recently viewed products.</p>';
                return;
            }
            
            let html = '';
            recentlyViewedProducts.forEach(product => {
                html += `
                    <div class="product-card" data-category="${product.category}">
                        <div class="product-image">
                            ${product.image}
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">${product.name}</h3>
                            <p class="product-description">${product.description.substring(0, 80)}...</p>
                            <div class="product-price">${formatPrice(product.price)} ${product.unit}</div>
                            <a href="product-detail.html?id=${product.id}" class="btn btn-full">View Details</a>
                        </div>
                    </div>
                `;
            });
            
            recentlyViewedContainer.innerHTML = html;
        }
    </script>
</body>
</html>