<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Green Valley Farmers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .checkout-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }
        
        .checkout-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .step-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .progress-step.active .step-number {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .progress-step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .checkout-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .checkout-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .section-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .section-content.collapsed {
            max-height: 0;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .section-header.collapsed .toggle-icon {
            transform: rotate(180deg);
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .payment-method {
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .payment-method:hover {
            border-color: var(--secondary-color);
            background-color: #f0f7e6;
        }
        
        .payment-method.selected {
            border-color: var(--secondary-color);
            background-color: #f0f7e6;
        }
        
        .payment-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #666;
        }
        
        .payment-method.selected .payment-icon {
            color: var(--secondary-color);
        }
        
        .order-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .order-summary-item:last-child {
            border-bottom: none;
        }
        
        .order-total {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            padding-top: 15px;
            border-top: 2px solid #eee;
        }
        
        .secure-checkout {
            background-color: #f0f7e6;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-top: 20px;
        }
        
        .secure-checkout i {
            color: var(--success-color);
            margin-right: 10px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .confirmation-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .confirmation-icon {
            font-size: 60px;
            color: var(--success-color);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Skip to Content Link (Accessibility) -->
    <a href="#main-content" class="skip-to-content">Skip to Content</a>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-seedling logo-icon"></i>
                <span class="logo-text">Green Valley Farmers</span>
            </a>
            
            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="main-nav" aria-label="Main navigation">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="cart.html">Cart <span class="cart-count">0</span></a></li>
                    <li><a href="#" class="btn btn-accent">Farmer Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb" style="background-color: #f9f9f9; padding: 15px 0;">
        <div class="container">
            <a href="index.html">Home</a> &gt; 
            <a href="products.html">Products</a> &gt; 
            <a href="cart.html">Cart</a> &gt; 
            <span>Checkout</span>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <section class="checkout-page">
            <div class="container">
                <!-- Checkout Progress -->
                <div class="checkout-progress">
                    <div class="progress-step active">
                        <div class="step-number">1</div>
                        <div class="step-label">Information</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">2</div>
                        <div class="step-label">Shipping</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">3</div>
                        <div class="step-label">Payment</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">4</div>
                        <div class="step-label">Confirmation</div>
                    </div>
                </div>
                
                <!-- Empty Cart Warning -->
                <div id="empty-cart-warning" class="error-state" style="display: none;">
                    <div class="error-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h3>Your cart is empty</h3>
                    <p>You need to add items to your cart before proceeding to checkout.</p>
                    <div style="margin-top: 20px;">
                        <a href="products.html" class="btn btn-accent">Continue Shopping</a>
                    </div>
                </div>
                
                <!-- Checkout Form -->
                <div id="checkout-form-container" style="display: none;">
                    <div class="checkout-container">
                        <!-- Left Column: Checkout Form -->
                        <div class="checkout-form">
                            <h2>Checkout</h2>
                            
                            <!-- Contact Information -->
                            <div class="checkout-section">
                                <div class="section-header" id="contact-header">
                                    <h3><i class="fas fa-user"></i> Contact Information</h3>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </div>
                                <div class="section-content" id="contact-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="first-name">First Name *</label>
                                            <input type="text" id="first-name" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="last-name">Last Name *</label>
                                            <input type="text" id="last-name" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email Address *</label>
                                        <input type="email" id="email" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Phone Number *</label>
                                        <input type="tel" id="phone" required>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Shipping Address -->
                            <div class="checkout-section">
                                <div class="section-header" id="shipping-header">
                                    <h3><i class="fas fa-truck"></i> Shipping Address</h3>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </div>
                                <div class="section-content" id="shipping-content">
                                    <div class="form-group">
                                        <label for="address">Street Address *</label>
                                        <input type="text" id="address" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="address2">Apartment, Suite, etc. (optional)</label>
                                        <input type="text" id="address2">
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="city">City *</label>
                                            <input type="text" id="city" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="state">State *</label>
                                            <select id="state" required>
                                                <option value="">Select State</option>
                                                <option value="CA">California</option>
                                                <option value="NY">New York</option>
                                                <option value="TX">Texas</option>
                                                <option value="FL">Florida</option>
                                                <option value="WA">Washington</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="zip">ZIP Code *</label>
                                            <input type="text" id="zip" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="country">Country *</label>
                                            <select id="country" required>
                                                <option value="US">United States</option>
                                                <option value="CA">Canada</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="save-address"> Save this address for future use
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Shipping Method -->
                            <div class="checkout-section">
                                <div class="section-header" id="shipping-method-header">
                                    <h3><i class="fas fa-shipping-fast"></i> Shipping Method</h3>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </div>
                                <div class="section-content" id="shipping-method-content">
                                    <div class="shipping-options">
                                        <div class="form-group">
                                            <label style="display: flex; align-items: center; padding: 15px; border: 2px solid var(--secondary-color); border-radius: var(--border-radius); background-color: #f0f7e6;">
                                                <input type="radio" name="shipping" value="standard" checked style="margin-right: 15px;">
                                                <div style="flex-grow: 1;">
                                                    <div style="font-weight: 600;">Standard Shipping</div>
                                                    <div style="color: #666; font-size: 0.9rem;">3-5 business days</div>
                                                </div>
                                                <div style="font-weight: 600; color: var(--accent-color);">
                                                    $5.99
                                                </div>
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label style="display: flex; align-items: center; padding: 15px; border: 2px solid #e0e0e0; border-radius: var(--border-radius);">
                                                <input type="radio" name="shipping" value="express" style="margin-right: 15px;">
                                                <div style="flex-grow: 1;">
                                                    <div style="font-weight: 600;">Express Shipping</div>
                                                    <div style="color: #666; font-size: 0.9rem;">1-2 business days</div>
                                                </div>
                                                <div style="font-weight: 600; color: var(--accent-color);">
                                                    $12.99
                                                </div>
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label style="display: flex; align-items: center; padding: 15px; border: 2px solid #e0e0e0; border-radius: var(--border-radius);">
                                                <input type="radio" name="shipping" value="free" style="margin-right: 15px;">
                                                <div style="flex-grow: 1;">
                                                    <div style="font-weight: 600;">Free Shipping</div>
                                                    <div style="color: #666; font-size: 0.9rem;">Orders over $50</div>
                                                </div>
                                                <div style="font-weight: 600; color: var(--success-color);">
                                                    FREE
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Method -->
                            <div class="checkout-section">
                                <div class="section-header" id="payment-header">
                                    <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </div>
                                <div class="section-content" id="payment-content">
                                    <div class="payment-methods">
                                        <div class="payment-method" id="card-payment">
                                            <div class="payment-icon">
                                                <i class="far fa-credit-card"></i>
                                            </div>
                                            <div>Credit Card</div>
                                        </div>
                                        <div class="payment-method" id="paypal-payment">
                                            <div class="payment-icon">
                                                <i class="fab fa-paypal"></i>
                                            </div>
                                            <div>PayPal</div>
                                        </div>
                                        <div class="payment-method" id="apple-pay">
                                            <div class="payment-icon">
                                                <i class="fab fa-apple-pay"></i>
                                            </div>
                                            <div>Apple Pay</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Credit Card Form (shown when card payment is selected) -->
                                    <div id="card-form" style="margin-top: 20px;">
                                        <div class="form-group">
                                            <label for="card-number">Card Number *</label>
                                            <input type="text" id="card-number" placeholder="1234 5678 9012 3456">
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="expiry">Expiry Date *</label>
                                                <input type="text" id="expiry" placeholder="MM/YY">
                                            </div>
                                            <div class="form-group">
                                                <label for="cvv">CVV *</label>
                                                <input type="text" id="cvv" placeholder="123">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="card-name">Name on Card *</label>
                                            <input type="text" id="card-name" placeholder="John Doe">
                                        </div>
                                    </div>
                                    
                                    <!-- PayPal Note -->
                                    <div id="paypal-note" style="display: none; margin-top: 20px; padding: 15px; background-color: #fff8e1; border-radius: var(--border-radius);">
                                        <p><i class="fas fa-info-circle"></i> You will be redirected to PayPal to complete your payment.</p>
                                    </div>
                                    
                                    <!-- Apple Pay Note -->
                                    <div id="apple-pay-note" style="display: none; margin-top: 20px; padding: 15px; background-color: #f0f0f0; border-radius: var(--border-radius);">
                                        <p><i class="fas fa-info-circle"></i> Apple Pay will open on your device to complete the payment.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Notes -->
                            <div class="checkout-section">
                                <div class="section-header" id="notes-header">
                                    <h3><i class="fas fa-sticky-note"></i> Order Notes</h3>
                                    <i class="fas fa-chevron-down toggle-icon"></i>
                                </div>
                                <div class="section-content" id="notes-content">
                                    <div class="form-group">
                                        <label for="order-notes">Special instructions for your order</label>
                                        <textarea id="order-notes" placeholder="e.g., Leave package at front door, specific delivery time, etc." rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Order Summary -->
                        <div class="checkout-summary">
                            <h3>Order Summary</h3>
                            
                            <div id="order-summary-items">
                                <!-- Order items will be loaded by JavaScript -->
                            </div>
                            
                            <div class="order-summary-item">
                                <span>Subtotal</span>
                                <span id="summary-subtotal">$0.00</span>
                            </div>
                            <div class="order-summary-item">
                                <span>Shipping</span>
                                <span id="summary-shipping">$5.99</span>
                            </div>
                            <div class="order-summary-item" id="summary-discount" style="display: none;">
                                <span>Discount</span>
                                <span id="summary-discount-amount" style="color: var(--success-color);">-$0.00</span>
                            </div>
                            <div class="order-summary-item order-total">
                                <span>Total</span>
                                <span id="summary-total">$0.00</span>
                            </div>
                            
                            <div class="secure-checkout">
                                <i class="fas fa-lock"></i> Secure Checkout
                            </div>
                            
                            <button id="place-order" class="btn btn-accent btn-full btn-large" style="margin-top: 20px;">
                                <i class="fas fa-lock"></i> Place Order
                            </button>
                            
                            <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #666;">
                                By placing your order, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.
                            </p>
                            
                            <div style="margin-top: 30px;">
                                <h4>Need Help?</h4>
                                <p style="font-size: 0.9rem; color: #666;">
                                    <i class="fas fa-phone"></i> Call us: (555) 123-4567<br>
                                    <i class="fas fa-envelope"></i> Email: help@greenvalleyfarmers.com
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <h3>Processing Your Order</h3>
        <p>Please wait while we confirm your order...</p>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>Order Confirmed!</h2>
            <p id="order-number">Your order #ORD-12345678 has been placed successfully.</p>
            <p>You will receive an email confirmation shortly.</p>
            <p style="margin: 20px 0; padding: 15px; background-color: #f0f7e6; border-radius: var(--border-radius);">
                Estimated delivery: <strong id="delivery-date">October 25, 2023</strong>
            </p>
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <a href="index.html" class="btn btn-outline" style="flex: 1;">Continue Shopping</a>
                <button id="view-order" class="btn btn-accent" style="flex: 1;">View Order Details</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <div class="footer-logo">
                        <i class="fas fa-seedling"></i> Green Valley Farmers
                    </div>
                    <p>Connecting local farmers with communities through sustainable agriculture and fresh, organic produce since 2010.</p>
                    <div class="social-icons">
                        <a href="#" class="social-icon" aria-label="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon" aria-label="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="cart.html">Shopping Cart</a></li>
                        <li><a href="checkout.html">Checkout</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Customer Service</h4>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Returns & Refunds</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Contact Us</h4>
                    <p>123 Farm Road, Green Valley, CA 90210</p>
                    <p>Email: info@greenvalleyfarmers.com</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Green Valley Farmers. All rights reserved. | Designed with HCI principles for accessibility and user experience</p>
            </div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if cart is empty
            if (cart.length === 0) {
                document.getElementById('empty-cart-warning').style.display = 'block';
                document.getElementById('checkout-form-container').style.display = 'none';
                return;
            } else {
                document.getElementById('empty-cart-warning').style.display = 'none';
                document.getElementById('checkout-form-container').style.display = 'block';
            }
            
            // Initialize checkout page
            initCheckoutPage();
            
            // Load order summary
            loadOrderSummary();
            
            // Setup form validation and submission
            setupCheckoutForm();
        });
        
        function initCheckoutPage() {
            // Toggle section collapse/expand
            const sectionHeaders = document.querySelectorAll('.section-header');
            sectionHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const contentId = this.id.replace('header', 'content');
                    const content = document.getElementById(contentId);
                    
                    this.classList.toggle('collapsed');
                    content.classList.toggle('collapsed');
                });
            });
            
            // Payment method selection
            const paymentMethods = document.querySelectorAll('.payment-method');
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remove selected class from all methods
                    paymentMethods.forEach(m => m.classList.remove('selected'));
                    
                    // Add selected class to clicked method
                    this.classList.add('selected');
                    
                    // Show/hide appropriate forms
                    const methodId = this.id;
                    document.getElementById('card-form').style.display = 'none';
                    document.getElementById('paypal-note').style.display = 'none';
                    document.getElementById('apple-pay-note').style.display = 'none';
                    
                    if (methodId === 'card-payment') {
                        document.getElementById('card-form').style.display = 'block';
                    } else if (methodId === 'paypal-payment') {
                        document.getElementById('paypal-note').style.display = 'block';
                    } else if (methodId === 'apple-pay') {
                        document.getElementById('apple-pay-note').style.display = 'block';
                    }
                });
            });
            
            // Select card payment by default
            document.getElementById('card-payment').click();
            
            // Shipping method selection
            const shippingOptions = document.querySelectorAll('input[name="shipping"]');
            shippingOptions.forEach(option => {
                option.addEventListener('change', updateShippingCost);
            });
            
            // Update shipping cost based on cart total
            updateShippingCost();
        }
        
        function loadOrderSummary() {
            const orderSummaryItems = document.getElementById('order-summary-items');
            if (!orderSummaryItems) return;
            
            let html = '';
            cart.forEach(item => {
                const product = getProductById(item.id);
                if (!product) return;
                
                const itemTotal = item.price * item.quantity;
                
                html += `
                    <div class="order-summary-item">
                        <div>
                            <div style="font-weight: 600;">${item.name} Ã— ${item.quantity}</div>
                            <div style="font-size: 0.9rem; color: #666;">${product.unit}</div>
                        </div>
                        <span>${formatPrice(itemTotal)}</span>
                    </div>
                `;
            });
            
            orderSummaryItems.innerHTML = html;
            
            // Calculate and update totals
            updateOrderTotals();
        }
        
        function updateOrderTotals() {
            const subtotal = getCartTotal();
            const shippingElement = document.querySelector('input[name="shipping"]:checked');
            const shippingValue = shippingElement ? shippingElement.value : 'standard';
            
            let shippingCost = 5.99;
            if (shippingValue === 'free' && subtotal >= 50) {
                shippingCost = 0;
            } else if (shippingValue === 'express') {
                shippingCost = 12.99;
            }
            
            // Apply promo code discount if any
            let discount = 0;
            const promoCode = localStorage.getItem('activePromoCode');
            if (promoCode === 'FARMER10' && subtotal > 0) {
                discount = subtotal * 0.10; // 10% discount
            }
            
            const total = subtotal + shippingCost - discount;
            
            // Update display
            document.getElementById('summary-subtotal').textContent = formatPrice(subtotal);
            document.getElementById('summary-shipping').textContent = shippingCost === 0 ? 'FREE' : formatPrice(shippingCost);
            document.getElementById('summary-total').textContent = formatPrice(total);
            
            // Show/hide discount row
            const discountRow = document.getElementById('summary-discount');
            const discountAmount = document.getElementById('summary-discount-amount');
            if (discount > 0) {
                discountRow.style.display = 'flex';
                discountAmount.textContent = '-' + formatPrice(discount);
            } else {
                discountRow.style.display = 'none';
            }
            
            // Update free shipping eligibility
            updateFreeShippingOption(subtotal);
        }
        
        function updateShippingCost() {
            updateOrderTotals();
        }
        
        function updateFreeShippingOption(subtotal) {
            const freeShippingRadio = document.querySelector('input[value="free"]');
            const freeShippingLabel = freeShippingRadio ? freeShippingRadio.closest('label') : null;
            
            if (freeShippingLabel) {
                if (subtotal >= 50) {
                    freeShippingLabel.style.opacity = '1';
                    freeShippingLabel.style.cursor = 'pointer';
                    freeShippingRadio.disabled = false;
                } else {
                    freeShippingLabel.style.opacity = '0.6';
                    freeShippingLabel.style.cursor = 'not-allowed';
                    freeShippingRadio.disabled = true;
                    
                    // If free shipping is selected but not eligible, switch to standard
                    if (freeShippingRadio.checked) {
                        document.querySelector('input[value="standard"]').checked = true;
                        updateShippingCost();
                    }
                }
            }
        }
        
        function setupCheckoutForm() {
            const placeOrderBtn = document.getElementById('place-order');
            if (!placeOrderBtn) return;
            
            placeOrderBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Validate form
                if (!validateCheckoutForm()) {
                    return;
                }
                
                // Show loading overlay
                document.getElementById('loading-overlay').style.display = 'flex';
                
                // Simulate order processing delay
                setTimeout(() => {
                    // Hide loading overlay
                    document.getElementById('loading-overlay').style.display = 'none';
                    
                    // Show confirmation modal
                    showOrderConfirmation();
                }, 2000);
            });
        }
        
        function validateCheckoutForm() {
            const requiredFields = [
                'first-name', 'last-name', 'email', 'phone',
                'address', 'city', 'state', 'zip', 'country'
            ];
            
            let isValid = true;
            
            // Clear previous error styles
            document.querySelectorAll('.form-group input, .form-group select').forEach(field => {
                field.style.borderColor = '';
                const error = field.nextElementSibling;
                if (error && error.classList.contains('error-message')) {
                    error.remove();
                }
            });
            
            // Validate required fields
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    field.style.borderColor = 'var(--error-color)';
                    showFieldError(field, 'This field is required');
                    isValid = false;
                }
            });
            
            // Validate email format
            const emailField = document.getElementById('email');
            if (emailField && emailField.value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailField.value)) {
                    emailField.style.borderColor = 'var(--error-color)';
                    showFieldError(emailField, 'Please enter a valid email address');
                    isValid = false;
                }
            }
            
            // Validate phone format
            const phoneField = document.getElementById('phone');
            if (phoneField && phoneField.value) {
                const phoneRegex = /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/;
                if (!phoneRegex.test(phoneField.value.replace(/\s/g, ''))) {
                    phoneField.style.borderColor = 'var(--error-color)';
                    showFieldError(phoneField, 'Please enter a valid phone number');
                    isValid = false;
                }
            }
            
            // Validate card details if card payment is selected
            if (document.getElementById('card-payment').classList.contains('selected')) {
                const cardFields = ['card-number', 'expiry', 'cvv', 'card-name'];
                cardFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field || !field.value.trim()) {
                        field.style.borderColor = 'var(--error-color)';
                        showFieldError(field, 'This field is required');
                        isValid = false;
                    }
                });
            }
            
            if (!isValid) {
                showToast('error', 'Please fill in all required fields correctly.');
                // Scroll to first error
                const firstError = document.querySelector('[style*="border-color: var(--error-color)"]');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            return isValid;
        }
        
        function showFieldError(field, message) {
            // Check if error already exists
            let errorElement = field.nextElementSibling;
            if (!errorElement || !errorElement.classList.contains('error-message')) {
                errorElement = document.createElement('div');
                errorElement.className = 'error-message';
                errorElement.style.color = 'var(--error-color)';
                errorElement.style.fontSize = '0.9rem';
                errorElement.style.marginTop = '5px';
                field.parentNode.appendChild(errorElement);
            }
            errorElement.textContent = message;
        }
        
        function showOrderConfirmation() {
            // Generate order number
            const orderNumber = 'ORD-' + Date.now().toString().slice(-8);
            
            // Calculate delivery date (3 days from now)
            const deliveryDate = new Date();
            deliveryDate.setDate(deliveryDate.getDate() + 3);
            const formattedDate = deliveryDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update modal content
            document.getElementById('order-number').textContent = 
                `Your order #${orderNumber} has been placed successfully.`;
            document.getElementById('delivery-date').textContent = formattedDate;
            
            // Show modal
            document.getElementById('confirmation-modal').style.display = 'flex';
            
            // Add event listener to view order button
            document.getElementById('view-order').addEventListener('click', function() {
                // In a real app, this would redirect to order details page
                alert('In a real application, this would show order details.\n\n' +
                      `Order Number: ${orderNumber}\n` +
                      `Delivery Date: ${formattedDate}\n` +
                      `Total: ${document.getElementById('summary-total').textContent}`);
                
                // Clear cart and close modal
                clearCart();
                document.getElementById('confirmation-modal').style.display = 'none';
                
                // Redirect to home page
                window.location.href = 'index.html';
            });
            
            // Clear cart (in real app, this would happen after successful payment)
            clearCart();
            updateCartCount();
        }
    </script>
</body>
</html>